{% extends "admin/base_admin.html" %}
{% block title %}Gestion des demandes{% endblock %}
{% block content %}
<div class="admin-demands">
  <div class="container">
    <div class="page-header">
      <h1>Gestion des demandes</h1>
      <a
        href="{{ url_for('admin.tableau_de_bord_admin') }}"
        class="btn btn-secondary"
      >
        <i class="fas fa-tachometer-alt"></i> Tableau de bord
      </a>
    </div>

    <!-- Filtres -->
    <div class="filters-section">
      <form method="GET" class="filters-form">
        <div class="filters-grid">
          <div class="filter-group">
            <label for="statut">Statut:</label>
            <select name="statut" id="statut" class="form-control">
              <option value="">Tous les statuts</option>
              <option
                value="nouveau"
                {% if statut_filtre == "nouveau" %}selected{% endif %}
              >
                Nouveau
              </option>
              <option
                value="en_cours"
                {% if statut_filtre == "en_cours" %}selected{% endif %}
              >
                En cours
              </option>
              <option
                value="traite"
                {% if statut_filtre == "traite" %}selected{% endif %}
              >
                Traité
              </option>
            </select>
          </div>

          <div class="filter-group">
            <label for="service">Service:</label>
            <select name="service" id="service" class="form-control">
              <option value="">Tous les services</option>
              <option
                value="gestion_affaires"
                {% if service_filtre == "gestion_affaires" %}selected{% endif %}
              >
                Gestion d'affaires
              </option>
              <option
                value="prestige_immobilier"
                {% if service_filtre == "prestige_immobilier" %}selected{% endif %}
              >
                Prestige Immobilier
              </option>
              <option
                value="logistique"
                {% if service_filtre == "logistique" %}selected{% endif %}
              >
                Logistique
              </option>
            </select>
          </div>

          <div class="filter-actions">
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-filter"></i> Filtrer
            </button>
            <a
              href="{{ url_for('admin.liste_demandes_admin') }}"
              class="btn btn-secondary"
            >
              <i class="fas fa-times"></i> Réinitialiser
            </a>
          </div>
        </div>
      </form>
    </div>

    <!-- Liste des demandes -->
    <div class="demands-table-container">
      <div class="table-header">
        <h2>Demandes ({{ demandes.total }})</h2>
      </div>

      {% if demandes.items %}
      <div class="demands-table">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Client</th>
              <th>Service</th>
              <th>Statut</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for demande in demandes.items %}
            <tr>
              <td>#{{ demande.id }}</td>
              <td>
                <div class="client-info">
                  <strong>{{ demande.nom }} {{ demande.prenom }}</strong>
                  <br />
                  <small>{{ demande.email }}</small>
                </div>
              </td>
              <td>{{ demande.service }}</td>
              <td>
                <span class="status-badge status-{{ demande.statut }}">
                  {{ demande.statut }}
                </span>
              </td>
              <td>{{ demande.date_creation | format_datetime }}</td>
              <td>
                <a
                  href="{{ url_for('admin.detail_demande_admin', demande_id=demande.id) }}"
                  class="btn btn-sm btn-primary"
                >
                  <i class="fas fa-eye"></i> Voir
                </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      {% if demandes.pages > 1 %}
      <div class="pagination">
        {% if demandes.has_prev %}
        <a
          href="{{ url_for('admin.liste_demandes_admin', page=demandes.prev_num, statut=statut_filtre, service=service_filtre) }}"
          class="page-link"
        >
          <i class="fas fa-chevron-left"></i> Précédent
        </a>
        {% endif %} {% for page_num in demandes.iter_pages() %} {% if page_num
        %} {% if page_num == demandes.page %}
        <span class="page-link current">{{ page_num }}</span>
        {% else %}
        <a
          href="{{ url_for('admin.liste_demandes_admin', page=page_num, statut=statut_filtre, service=service_filtre) }}"
          class="page-link"
          >{{ page_num }}</a
        >
        {% endif %} {% else %}
        <span class="page-link">...</span>
        {% endif %} {% endfor %} {% if demandes.has_next %}
        <a
          href="{{ url_for('admin.liste_demandes_admin', page=demandes.next_num, statut=statut_filtre, service=service_filtre) }}"
          class="page-link"
        >
          Suivant <i class="fas fa-chevron-right"></i>
        </a>
        {% endif %}
      </div>
      {% endif %} {% else %}
      <div class="no-demands">
        <i class="fas fa-inbox"></i>
        <h3>Aucune demande trouvée</h3>
        <p>Il n'y a pas de demandes correspondant aux critères sélectionnés.</p>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
{% block extra_head %}{% endblock %}